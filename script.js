// --- PREGUNTAS ---
const preguntas = [
  {
  texto: "Quin és l’objectiu principal d’un Sistema de Gestió Ambiental (SGA)?",
  opciones: [
    "a) Augmentar la producció industrial",
    "b) Controlar i reduir l’impacte ambiental de les activitats d’una organització",
    "c) Millorar la seguretat laboral dels treballadors",
    "d) Incrementar el benefici econòmic"
  ],
  correcta: "b"
},
{
  texto: "Quina és la norma internacional de referència per implantar un SGA?",
  opciones: [
    "a) ISO 9001",
    "b) ISO 14001",
    "c) ISO 45001",
    "d) ISO 50001"
  ],
  correcta: "b"
},
{
  texto: "Quin reglament europeu estableix el sistema EMAS?",
  opciones: [
    "a) Reglament (CE) 1221/2009",
    "b) Reglament (UE) 333/2008",
    "c) Reglament (UE) 2013/115",
    "d) Reglament (CE) 2001/12"
  ],
  correcta: "a"
},
{
  texto: "Quina és la principal diferència entre ISO 14001 i EMAS?",
  opciones: [
    "a) EMAS és voluntari i exigeix una declaració ambiental verificada externament",
    "b) ISO 14001 és obligatòria per a totes les empreses europees",
    "c) EMAS no requereix verificació externa",
    "d) ISO 14001 no contempla la millora contínua"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va publicar la primera versió de la norma ISO 14001?",
  opciones: [
    "a) 1992",
    "b) 1996",
    "c) 2004",
    "d) 2015"
  ],
  correcta: "b"
},
{
  texto: "Quin any es va publicar l’actual versió vigent de la ISO 14001?",
  opciones: [
    "a) 2004",
    "b) 2008",
    "c) 2012",
    "d) 2015"
  ],
  correcta: "d"
},
{
  texto: "Quina és la primera fase del cicle PDCA (Plan-Do-Check-Act) en un SGA?",
  opciones: [
    "a) Implementar",
    "b) Planificar",
    "c) Verificar",
    "d) Actuar"
  ],
  correcta: "b"
},
{
  texto: "Quina fase del cicle PDCA correspon a l’avaluació del compliment i la revisió interna?",
  opciones: [
    "a) Planificar",
    "b) Fer (Do)",
    "c) Verificar (Check)",
    "d) Actuar (Act)"
  ],
  correcta: "c"
},
{
  texto: "Quina és la darrera fase del cicle PDCA en un SGA?",
  opciones: [
    "a) Actuar (millorar el sistema)",
    "b) Planificar noves accions",
    "c) Documentar resultats",
    "d) Revisar la direcció"
  ],
  correcta: "a"
},
{
  texto: "Quina eina utilitza un SGA per identificar els aspectes ambientals d’una organització?",
  opciones: [
    "a) L’auditoria ambiental",
    "b) L’avaluació d’aspectes i impactes ambientals",
    "c) L’informe financer",
    "d) L’anàlisi DAFO"
  ],
  correcta: "b"
},
{
  texto: "Què és un aspecte ambiental?",
  opciones: [
    "a) Una acció o element de les activitats que pot tenir un impacte sobre el medi ambient",
    "b) Un indicador de rendiment econòmic",
    "c) Un residu urbà generat per l’activitat",
    "d) Un objectiu de producció"
  ],
  correcta: "a"
},
{
  texto: "Què és un impacte ambiental?",
  opciones: [
    "a) El resultat positiu o negatiu sobre el medi derivat d’un aspecte ambiental",
    "b) El nombre de treballadors afectats per la contaminació",
    "c) La despesa energètica d’una empresa",
    "d) L’auditoria anual de qualitat"
  ],
  correcta: "a"
},
{
  texto: "Quin és un exemple d’aspecte ambiental directe?",
  opciones: [
    "a) L’ús d’energia a la fàbrica",
    "b) L’activitat dels proveïdors externs",
    "c) Les decisions polítiques de la direcció",
    "d) Els hàbits de consum dels clients"
  ],
  correcta: "a"
},
{
  texto: "Quin és un exemple d’aspecte ambiental indirecte?",
  opciones: [
    "a) El consum d’aigua de producció",
    "b) El transport dels productes als clients",
    "c) La il·luminació de la planta industrial",
    "d) Les emissions d’un motor intern"
  ],
  correcta: "b"
},
{
  texto: "Quina és la primera etapa per implantar un SGA?",
  opciones: [
    "a) Realitzar una revisió ambiental inicial",
    "b) Fer una auditoria de certificació",
    "c) Contractar un verificador EMAS",
    "d) Publicar la política ambiental"
  ],
  correcta: "a"
},
{
  texto: "Què s’ha d’incloure en la política ambiental d’una organització?",
  opciones: [
    "a) Compromís amb la millora contínua, prevenció de la contaminació i compliment legal",
    "b) Objectius comercials i de màrqueting",
    "c) Compromís amb la productivitat i el benefici",
    "d) Informació sobre l’estructura organitzativa"
  ],
  correcta: "a"
},
{
  texto: "Quin document recull els objectius i metes ambientals d’una empresa?",
  opciones: [
    "a) El manual de gestió ambiental",
    "b) La política de seguretat i salut",
    "c) L’auditoria de producte",
    "d) El pla de màrqueting"
  ],
  correcta: "a"
},
{
  texto: "Què és una auditoria ambiental interna?",
  opciones: [
    "a) Una revisió sistemàtica per verificar si el SGA compleix la norma ISO 14001",
    "b) Una inspecció de qualitat de producte",
    "c) Una reunió comercial periòdica",
    "d) Una revisió de recursos humans"
  ],
  correcta: "a"
},
{
  texto: "Amb quina periodicitat s’haurien de fer les auditories internes d’un SGA?",
  opciones: [
    "a) Cada mes",
    "b) Cada 6 mesos",
    "c) Almenys un cop l’any o segons el pla d’auditoria",
    "d) Cada 5 anys"
  ],
  correcta: "c"
},
{
  texto: "Quin és el paper de la direcció dins d’un SGA?",
  opciones: [
    "a) Participar activament en la revisió del sistema i assegurar recursos per a la seva millora",
    "b) Delegar tota la responsabilitat al tècnic ambiental",
    "c) Supervisar només els informes econòmics",
    "d) Fer auditories externes"
  ],
  correcta: "a"
},
{
  texto: "Quina d’aquestes fases forma part del procés d’implantació d’un SGA segons la ISO 14001?",
  opciones: [
    "a) Revisió ambiental inicial, planificació, implementació, verificació i revisió per la direcció",
    "b) Només revisió documental i auditoria externa",
    "c) Planificació, execució i tancament financer",
    "d) Auditoria econòmica, revisió legal i control de qualitat"
  ],
  correcta: "a"
},
{
  texto: "Quin document descriu les funcions, responsabilitats i procediments del SGA?",
  opciones: [
    "a) El manual de gestió ambiental",
    "b) L’informe de sostenibilitat",
    "c) El reglament intern de personal",
    "d) L’avaluació de riscos laborals"
  ],
  correcta: "a"
},
{
  texto: "Quin és el principi fonamental d’un SGA segons la ISO 14001:2015?",
  opciones: [
    "a) L’enfocament basat en riscos i oportunitats",
    "b) L’ús d’energies renovables obligatori",
    "c) La verificació externa semestral",
    "d) La centralització de la gestió ambiental"
  ],
  correcta: "a"
},
{
  texto: "Què estableix la ISO 14001 respecte al compliment legal?",
  opciones: [
    "a) Que és opcional per a empreses petites",
    "b) Que és un requisit obligatori del sistema",
    "c) Que només s’aplica a sectors industrials",
    "d) Que es pot substituir per compromisos voluntaris"
  ],
  correcta: "b"
},
{
  texto: "Què ha de demostrar una organització per obtenir la certificació ISO 14001?",
  opciones: [
    "a) Que aplica un sistema de gestió ambiental conforme a la norma i millora contínuament",
    "b) Que redueix un 50% les emissions anuals",
    "c) Que publica informes financers verds",
    "d) Que disposa d’un equip auditat per EMAS"
  ],
  correcta: "a"
},
{
  texto: "Quin organisme acredita els certificadors de la norma ISO 14001 a Espanya?",
  opciones: [
    "a) ENAC (Entidad Nacional de Acreditación)",
    "b) AENOR Internacional",
    "c) Ministeri de Medi Ambient",
    "d) ISO World Association"
  ],
  correcta: "a"
},
{
  texto: "Quin document públic exigeix el sistema EMAS i no la ISO 14001?",
  opciones: [
    "a) La declaració ambiental verificada",
    "b) L’auditoria econòmica anual",
    "c) L’informe intern de riscos",
    "d) L’estudi de mercat ambiental"
  ],
  correcta: "a"
},
{
  texto: "Quina informació ha d’incloure la declaració ambiental EMAS?",
  opciones: [
    "a) Objectius ambientals, indicadors i resultats de millora contínua",
    "b) El balanç econòmic de l’empresa",
    "c) Només les dades de consum energètic",
    "d) Informació confidencial sobre processos industrials"
  ],
  correcta: "a"
},
{
  texto: "Cada quant temps s’ha de renovar la verificació EMAS?",
  opciones: [
    "a) Cada any",
    "b) Cada 2 anys",
    "c) Cada 3 anys (o 4 per PIME)",
    "d) Cada 5 anys"
  ],
  correcta: "c"
},
{
  texto: "Quin logotip poden utilitzar les empreses registrades en el sistema EMAS?",
  opciones: [
    "a) El logotip verd amb fulles i estrelles de la UE",
    "b) El logotip ISO en color blau",
    "c) El segell internacional de sostenibilitat",
    "d) El símbol de reciclatge universal"
  ],
  correcta: "a"
},
{
  texto: "Quina és una diferència addicional entre ISO 14001 i EMAS?",
  opciones: [
    "a) EMAS requereix compliment legal obligatori verificat per tercers",
    "b) ISO 14001 inclou sempre la declaració pública ambiental",
    "c) EMAS no contempla millora contínua",
    "d) ISO 14001 és més exigent en la comunicació externa"
  ],
  correcta: "a"
},
{
  texto: "Quina és la relació entre la ISO 9001 i la ISO 14001?",
  opciones: [
    "a) Tenen una estructura d’alt nivell comuna (Annex SL)",
    "b) Són incompatibles entre si",
    "c) La ISO 9001 és més ambiental",
    "d) Només es poden aplicar en indústries químiques"
  ],
  correcta: "a"
},
{
  texto: "Què promou el concepte d’'enfocament al cicle de vida' en la ISO 14001:2015?",
  opciones: [
    "a) Considerar impactes ambientals en totes les etapes del producte, des del disseny fins al final de vida",
    "b) Limitar-se a la fase de producció",
    "c) Avaluar només l’impacte econòmic del producte",
    "d) Aplicar controls únicament al transport"
  ],
  correcta: "a"
},
{
  texto: "Què s’ha de fer abans d’establir objectius ambientals en un SGA?",
  opciones: [
    "a) Identificar els aspectes ambientals significatius i requisits legals aplicables",
    "b) Contractar un verificador extern",
    "c) Revisar l’informe financer anual",
    "d) Formar tot el personal en seguretat laboral"
  ],
  correcta: "a"
},
{
  texto: "Quin tipus de formació ha de rebre el personal dins d’un SGA?",
  opciones: [
    "a) Formació en aspectes ambientals, bones pràctiques i emergències",
    "b) Formació en vendes i màrqueting",
    "c) Formació en gestió econòmica",
    "d) Formació en disseny gràfic"
  ],
  correcta: "a"
},
{
  texto: "Quina és la funció d’un indicador ambiental dins d’un SGA?",
  opciones: [
    "a) Mesurar el rendiment ambiental i facilitar la millora contínua",
    "b) Controlar només els residus sòlids",
    "c) Registrar incidències econòmiques",
    "d) Substituir les auditories internes"
  ],
  correcta: "a"
},
{
  texto: "Quin exemple d’indicador ambiental pot utilitzar-se en un SGA?",
  opciones: [
    "a) kWh d’energia consumida per unitat produïda",
    "b) Benefici net anual",
    "c) Nombre de treballadors",
    "d) Costos logístics totals"
  ],
  correcta: "a"
},
{
  texto: "Quina d’aquestes activitats es considera una millora ambiental segons la ISO 14001?",
  opciones: [
    "a) Reduir el consum d’aigua en un procés productiu",
    "b) Incrementar la producció un 10%",
    "c) Reduir el temps de treball",
    "d) Ampliar les instal·lacions industrials"
  ],
  correcta: "a"
},
{
  texto: "Què significa el principi de millora contínua dins d’un SGA?",
  opciones: [
    "a) Repetir les mateixes pràctiques anualment",
    "b) Introduir canvis progressius per reduir impactes ambientals i augmentar eficiència",
    "c) Fer auditories cada cinc anys",
    "d) Substituir l’auditoria per una enquesta"
  ],
  correcta: "b"
},
{
  texto: "Quina d’aquestes afirmacions és correcta sobre la relació entre ISO 14001 i EMAS?",
  opciones: [
    "a) Totes les organitzacions EMAS compleixen ISO 14001, però no a la inversa",
    "b) Són sistemes incompatibles",
    "c) EMAS depèn directament d’AENOR",
    "d) ISO 14001 és exclusiva per empreses públiques"
  ],
  correcta: "a"
}
];
// --- FRASES DE ÁNIMO ---
const frases_animo = [
  "¡Muy bien! 😎",
  "¡Eso es, perfecto, te camelo caramelo! 🔥",
  "¡Ole tú huevos! 💪",
  "¡Exacto, estás on fire! 🚀",
  "¡Qué máquina eres! 😍",
  "¡Correcto, así se hace! 👏",
  "¡Te lo sabes de memoria ya! 💥"
];

// --- VARIABLES ---
let i = 0;
let puntuacion = 0;
let preguntasParaEsteTest = [];

// --- FUNCIONES ---

/**
 * Baraja un array aleatoriamente (algoritmo Fisher-Yates).
 * @param {Array} array El array a barajar.
 */
function barajarPreguntas(array) {
  let currentIndex = array.length,  randomIndex;

  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
  return array;
}

/**
 * Muestra un mensaje en el chat.
 * @param {string} texto El contenido del mensaje.
 * @param {string} tipo 'bot' o 'user'.
 */
function mostrarMensaje(texto, tipo) {
  const chat = document.getElementById("chat");
  const msg = document.createElement("div");
  msg.classList.add("message", tipo);
  // Convierte los saltos de línea (\n) en etiquetas <br>
  msg.innerHTML = texto.replace(/\n/g, "<br>");
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

/**
 * Muestra la pregunta actual y sus opciones en un solo mensaje.
 */
function mostrarPregunta() {
  // Usa el array de 20 preguntas
  if (!preguntasParaEsteTest[i]) return;

  const p = preguntasParaEsteTest[i];
  // Une la pregunta y las opciones en un solo texto
  const textoCompleto = `${p.texto}\n\n${p.opciones.join("\n")}`;
  mostrarMensaje(textoCompleto, "bot");
}

/**
 * Procesa la respuesta del usuario.
 * @param {string} opcionElegida "a", "b", "c" o "d".
 */
function responder(opcionElegida) {
  // Usa el array de 20 preguntas
  if (!preguntasParaEsteTest[i]) return;

  const p = preguntasParaEsteTest[i];
  // Muestra solo la letra, como pediste
  mostrarMensaje(`${opcionElegida.toUpperCase()}`, "user");

  if (opcionElegida === p.correcta) {
    puntuacion++;
    mostrarMensaje(frases_animo[Math.floor(Math.random() * frases_animo.length)], "bot");
  } else {
    mostrarMensaje(`❌ Incorrecto. La respuesta correcta era ${p.correcta.toUpperCase()}.`, "bot");
  }

  i++;
  // Comprueba si quedan preguntas en el array de 20
  if (i < preguntasParaEsteTest.length) {
    setTimeout(mostrarPregunta, 800);
  } else {
    setTimeout(() => {
      // Muestra la puntuación final sobre 20 (o el total que haya)
      mostrarMensaje(`🏁 Has acertado ${puntuacion} de ${preguntasParaEsteTest.length} preguntas. 💡`, "bot");
      desactivarBotones();
    }, 800);
  }
}

/**
 * Desactiva los botones de opción al final del test.
 */
function desactivarBotones() {
  document.querySelectorAll(".btn-opcion").forEach(btn => btn.disabled = true);
}

// --- ARRANQUE ---
document.addEventListener("DOMContentLoaded", () => {
  i = 0;
  puntuacion = 0;
  
  // 1. Barajamos TODO el array de preguntas
  barajarPreguntas(preguntas); 
  
  // 2. Nos quedamos solo con las 20 primeras (o menos, si el array es más corto)
  preguntasParaEsteTest = preguntas.slice(0, 20); 

  mostrarMensaje(`🧠 Bienvenido al test. Se han elegido ${preguntasParaEsteTest.length} preguntas al azar. 💬`, "bot");
  setTimeout(mostrarPregunta, 500);

  document.getElementById("btnA").onclick = () => responder("a");
  document.getElementById("btnB").onclick = () => responder("b");
  document.getElementById("btnC").onclick = () => responder("c");
  document.getElementById("btnD").onclick = () => responder("d");
});


