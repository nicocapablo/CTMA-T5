// --- PREGUNTAS ---
const preguntas = [
  {
  texto: "Quin Ã©s lâ€™objectiu principal dâ€™un Sistema de GestiÃ³ Ambiental (SGA)?",
  opciones: [
    "a) Augmentar la producciÃ³ industrial",
    "b) Controlar i reduir lâ€™impacte ambiental de les activitats dâ€™una organitzaciÃ³",
    "c) Millorar la seguretat laboral dels treballadors",
    "d) Incrementar el benefici econÃ²mic"
  ],
  correcta: "b"
},
{
  texto: "Quina Ã©s la norma internacional de referÃ¨ncia per implantar un SGA?",
  opciones: [
    "a) ISO 9001",
    "b) ISO 14001",
    "c) ISO 45001",
    "d) ISO 50001"
  ],
  correcta: "b"
},
{
  texto: "Quin reglament europeu estableix el sistema EMAS?",
  opciones: [
    "a) Reglament (CE) 1221/2009",
    "b) Reglament (UE) 333/2008",
    "c) Reglament (UE) 2013/115",
    "d) Reglament (CE) 2001/12"
  ],
  correcta: "a"
},
{
  texto: "Quina Ã©s la principal diferÃ¨ncia entre ISO 14001 i EMAS?",
  opciones: [
    "a) EMAS Ã©s voluntari i exigeix una declaraciÃ³ ambiental verificada externament",
    "b) ISO 14001 Ã©s obligatÃ²ria per a totes les empreses europees",
    "c) EMAS no requereix verificaciÃ³ externa",
    "d) ISO 14001 no contempla la millora contÃ­nua"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va publicar la primera versiÃ³ de la norma ISO 14001?",
  opciones: [
    "a) 1992",
    "b) 1996",
    "c) 2004",
    "d) 2015"
  ],
  correcta: "b"
},
{
  texto: "Quin any es va publicar lâ€™actual versiÃ³ vigent de la ISO 14001?",
  opciones: [
    "a) 2004",
    "b) 2008",
    "c) 2012",
    "d) 2015"
  ],
  correcta: "d"
},
{
  texto: "Quina Ã©s la primera fase del cicle PDCA (Plan-Do-Check-Act) en un SGA?",
  opciones: [
    "a) Implementar",
    "b) Planificar",
    "c) Verificar",
    "d) Actuar"
  ],
  correcta: "b"
},
{
  texto: "Quina fase del cicle PDCA correspon a lâ€™avaluaciÃ³ del compliment i la revisiÃ³ interna?",
  opciones: [
    "a) Planificar",
    "b) Fer (Do)",
    "c) Verificar (Check)",
    "d) Actuar (Act)"
  ],
  correcta: "c"
},
{
  texto: "Quina Ã©s la darrera fase del cicle PDCA en un SGA?",
  opciones: [
    "a) Actuar (millorar el sistema)",
    "b) Planificar noves accions",
    "c) Documentar resultats",
    "d) Revisar la direcciÃ³"
  ],
  correcta: "a"
},
{
  texto: "Quina eina utilitza un SGA per identificar els aspectes ambientals dâ€™una organitzaciÃ³?",
  opciones: [
    "a) Lâ€™auditoria ambiental",
    "b) Lâ€™avaluaciÃ³ dâ€™aspectes i impactes ambientals",
    "c) Lâ€™informe financer",
    "d) Lâ€™anÃ lisi DAFO"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ Ã©s un aspecte ambiental?",
  opciones: [
    "a) Una acciÃ³ o element de les activitats que pot tenir un impacte sobre el medi ambient",
    "b) Un indicador de rendiment econÃ²mic",
    "c) Un residu urbÃ  generat per lâ€™activitat",
    "d) Un objectiu de producciÃ³"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ Ã©s un impacte ambiental?",
  opciones: [
    "a) El resultat positiu o negatiu sobre el medi derivat dâ€™un aspecte ambiental",
    "b) El nombre de treballadors afectats per la contaminaciÃ³",
    "c) La despesa energÃ¨tica dâ€™una empresa",
    "d) Lâ€™auditoria anual de qualitat"
  ],
  correcta: "a"
},
{
  texto: "Quin Ã©s un exemple dâ€™aspecte ambiental directe?",
  opciones: [
    "a) Lâ€™Ãºs dâ€™energia a la fÃ brica",
    "b) Lâ€™activitat dels proveÃ¯dors externs",
    "c) Les decisions polÃ­tiques de la direcciÃ³",
    "d) Els hÃ bits de consum dels clients"
  ],
  correcta: "a"
},
{
  texto: "Quin Ã©s un exemple dâ€™aspecte ambiental indirecte?",
  opciones: [
    "a) El consum dâ€™aigua de producciÃ³",
    "b) El transport dels productes als clients",
    "c) La ilÂ·luminaciÃ³ de la planta industrial",
    "d) Les emissions dâ€™un motor intern"
  ],
  correcta: "b"
},
{
  texto: "Quina Ã©s la primera etapa per implantar un SGA?",
  opciones: [
    "a) Realitzar una revisiÃ³ ambiental inicial",
    "b) Fer una auditoria de certificaciÃ³",
    "c) Contractar un verificador EMAS",
    "d) Publicar la polÃ­tica ambiental"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ sâ€™ha dâ€™incloure en la polÃ­tica ambiental dâ€™una organitzaciÃ³?",
  opciones: [
    "a) CompromÃ­s amb la millora contÃ­nua, prevenciÃ³ de la contaminaciÃ³ i compliment legal",
    "b) Objectius comercials i de mÃ rqueting",
    "c) CompromÃ­s amb la productivitat i el benefici",
    "d) InformaciÃ³ sobre lâ€™estructura organitzativa"
  ],
  correcta: "a"
},
{
  texto: "Quin document recull els objectius i metes ambientals dâ€™una empresa?",
  opciones: [
    "a) El manual de gestiÃ³ ambiental",
    "b) La polÃ­tica de seguretat i salut",
    "c) Lâ€™auditoria de producte",
    "d) El pla de mÃ rqueting"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ Ã©s una auditoria ambiental interna?",
  opciones: [
    "a) Una revisiÃ³ sistemÃ tica per verificar si el SGA compleix la norma ISO 14001",
    "b) Una inspecciÃ³ de qualitat de producte",
    "c) Una reuniÃ³ comercial periÃ²dica",
    "d) Una revisiÃ³ de recursos humans"
  ],
  correcta: "a"
},
{
  texto: "Amb quina periodicitat sâ€™haurien de fer les auditories internes dâ€™un SGA?",
  opciones: [
    "a) Cada mes",
    "b) Cada 6 mesos",
    "c) Almenys un cop lâ€™any o segons el pla dâ€™auditoria",
    "d) Cada 5 anys"
  ],
  correcta: "c"
},
{
  texto: "Quin Ã©s el paper de la direcciÃ³ dins dâ€™un SGA?",
  opciones: [
    "a) Participar activament en la revisiÃ³ del sistema i assegurar recursos per a la seva millora",
    "b) Delegar tota la responsabilitat al tÃ¨cnic ambiental",
    "c) Supervisar nomÃ©s els informes econÃ²mics",
    "d) Fer auditories externes"
  ],
  correcta: "a"
},
{
  texto: "Quina dâ€™aquestes fases forma part del procÃ©s dâ€™implantaciÃ³ dâ€™un SGA segons la ISO 14001?",
  opciones: [
    "a) RevisiÃ³ ambiental inicial, planificaciÃ³, implementaciÃ³, verificaciÃ³ i revisiÃ³ per la direcciÃ³",
    "b) NomÃ©s revisiÃ³ documental i auditoria externa",
    "c) PlanificaciÃ³, execuciÃ³ i tancament financer",
    "d) Auditoria econÃ²mica, revisiÃ³ legal i control de qualitat"
  ],
  correcta: "a"
},
{
  texto: "Quin document descriu les funcions, responsabilitats i procediments del SGA?",
  opciones: [
    "a) El manual de gestiÃ³ ambiental",
    "b) Lâ€™informe de sostenibilitat",
    "c) El reglament intern de personal",
    "d) Lâ€™avaluaciÃ³ de riscos laborals"
  ],
  correcta: "a"
},
{
  texto: "Quin Ã©s el principi fonamental dâ€™un SGA segons la ISO 14001:2015?",
  opciones: [
    "a) Lâ€™enfocament basat en riscos i oportunitats",
    "b) Lâ€™Ãºs dâ€™energies renovables obligatori",
    "c) La verificaciÃ³ externa semestral",
    "d) La centralitzaciÃ³ de la gestiÃ³ ambiental"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ estableix la ISO 14001 respecte al compliment legal?",
  opciones: [
    "a) Que Ã©s opcional per a empreses petites",
    "b) Que Ã©s un requisit obligatori del sistema",
    "c) Que nomÃ©s sâ€™aplica a sectors industrials",
    "d) Que es pot substituir per compromisos voluntaris"
  ],
  correcta: "b"
},
{
  texto: "QuÃ¨ ha de demostrar una organitzaciÃ³ per obtenir la certificaciÃ³ ISO 14001?",
  opciones: [
    "a) Que aplica un sistema de gestiÃ³ ambiental conforme a la norma i millora contÃ­nuament",
    "b) Que redueix un 50% les emissions anuals",
    "c) Que publica informes financers verds",
    "d) Que disposa dâ€™un equip auditat per EMAS"
  ],
  correcta: "a"
},
{
  texto: "Quin organisme acredita els certificadors de la norma ISO 14001 a Espanya?",
  opciones: [
    "a) ENAC (Entidad Nacional de AcreditaciÃ³n)",
    "b) AENOR Internacional",
    "c) Ministeri de Medi Ambient",
    "d) ISO World Association"
  ],
  correcta: "a"
},
{
  texto: "Quin document pÃºblic exigeix el sistema EMAS i no la ISO 14001?",
  opciones: [
    "a) La declaraciÃ³ ambiental verificada",
    "b) Lâ€™auditoria econÃ²mica anual",
    "c) Lâ€™informe intern de riscos",
    "d) Lâ€™estudi de mercat ambiental"
  ],
  correcta: "a"
},
{
  texto: "Quina informaciÃ³ ha dâ€™incloure la declaraciÃ³ ambiental EMAS?",
  opciones: [
    "a) Objectius ambientals, indicadors i resultats de millora contÃ­nua",
    "b) El balanÃ§ econÃ²mic de lâ€™empresa",
    "c) NomÃ©s les dades de consum energÃ¨tic",
    "d) InformaciÃ³ confidencial sobre processos industrials"
  ],
  correcta: "a"
},
{
  texto: "Cada quant temps sâ€™ha de renovar la verificaciÃ³ EMAS?",
  opciones: [
    "a) Cada any",
    "b) Cada 2 anys",
    "c) Cada 3 anys (o 4 per PIME)",
    "d) Cada 5 anys"
  ],
  correcta: "c"
},
{
  texto: "Quin logotip poden utilitzar les empreses registrades en el sistema EMAS?",
  opciones: [
    "a) El logotip verd amb fulles i estrelles de la UE",
    "b) El logotip ISO en color blau",
    "c) El segell internacional de sostenibilitat",
    "d) El sÃ­mbol de reciclatge universal"
  ],
  correcta: "a"
},
{
  texto: "Quina Ã©s una diferÃ¨ncia addicional entre ISO 14001 i EMAS?",
  opciones: [
    "a) EMAS requereix compliment legal obligatori verificat per tercers",
    "b) ISO 14001 inclou sempre la declaraciÃ³ pÃºblica ambiental",
    "c) EMAS no contempla millora contÃ­nua",
    "d) ISO 14001 Ã©s mÃ©s exigent en la comunicaciÃ³ externa"
  ],
  correcta: "a"
},
{
  texto: "Quina Ã©s la relaciÃ³ entre la ISO 9001 i la ISO 14001?",
  opciones: [
    "a) Tenen una estructura dâ€™alt nivell comuna (Annex SL)",
    "b) SÃ³n incompatibles entre si",
    "c) La ISO 9001 Ã©s mÃ©s ambiental",
    "d) NomÃ©s es poden aplicar en indÃºstries quÃ­miques"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ promou el concepte dâ€™'enfocament al cicle de vida' en la ISO 14001:2015?",
  opciones: [
    "a) Considerar impactes ambientals en totes les etapes del producte, des del disseny fins al final de vida",
    "b) Limitar-se a la fase de producciÃ³",
    "c) Avaluar nomÃ©s lâ€™impacte econÃ²mic del producte",
    "d) Aplicar controls Ãºnicament al transport"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ sâ€™ha de fer abans dâ€™establir objectius ambientals en un SGA?",
  opciones: [
    "a) Identificar els aspectes ambientals significatius i requisits legals aplicables",
    "b) Contractar un verificador extern",
    "c) Revisar lâ€™informe financer anual",
    "d) Formar tot el personal en seguretat laboral"
  ],
  correcta: "a"
},
{
  texto: "Quin tipus de formaciÃ³ ha de rebre el personal dins dâ€™un SGA?",
  opciones: [
    "a) FormaciÃ³ en aspectes ambientals, bones prÃ ctiques i emergÃ¨ncies",
    "b) FormaciÃ³ en vendes i mÃ rqueting",
    "c) FormaciÃ³ en gestiÃ³ econÃ²mica",
    "d) FormaciÃ³ en disseny grÃ fic"
  ],
  correcta: "a"
},
{
  texto: "Quina Ã©s la funciÃ³ dâ€™un indicador ambiental dins dâ€™un SGA?",
  opciones: [
    "a) Mesurar el rendiment ambiental i facilitar la millora contÃ­nua",
    "b) Controlar nomÃ©s els residus sÃ²lids",
    "c) Registrar incidÃ¨ncies econÃ²miques",
    "d) Substituir les auditories internes"
  ],
  correcta: "a"
},
{
  texto: "Quin exemple dâ€™indicador ambiental pot utilitzar-se en un SGA?",
  opciones: [
    "a) kWh dâ€™energia consumida per unitat produÃ¯da",
    "b) Benefici net anual",
    "c) Nombre de treballadors",
    "d) Costos logÃ­stics totals"
  ],
  correcta: "a"
},
{
  texto: "Quina dâ€™aquestes activitats es considera una millora ambiental segons la ISO 14001?",
  opciones: [
    "a) Reduir el consum dâ€™aigua en un procÃ©s productiu",
    "b) Incrementar la producciÃ³ un 10%",
    "c) Reduir el temps de treball",
    "d) Ampliar les instalÂ·lacions industrials"
  ],
  correcta: "a"
},
{
  texto: "QuÃ¨ significa el principi de millora contÃ­nua dins dâ€™un SGA?",
  opciones: [
    "a) Repetir les mateixes prÃ ctiques anualment",
    "b) Introduir canvis progressius per reduir impactes ambientals i augmentar eficiÃ¨ncia",
    "c) Fer auditories cada cinc anys",
    "d) Substituir lâ€™auditoria per una enquesta"
  ],
  correcta: "b"
},
{
  texto: "Quina dâ€™aquestes afirmacions Ã©s correcta sobre la relaciÃ³ entre ISO 14001 i EMAS?",
  opciones: [
    "a) Totes les organitzacions EMAS compleixen ISO 14001, perÃ² no a la inversa",
    "b) SÃ³n sistemes incompatibles",
    "c) EMAS depÃ¨n directament dâ€™AENOR",
    "d) ISO 14001 Ã©s exclusiva per empreses pÃºbliques"
  ],
  correcta: "a"
}
];
// --- FRASES DE ÃNIMO ---
const frases_animo = [
Â  "Â¡Muy bien! ğŸ˜",
Â  "Â¡Eso es, perfecto, te camelo caramelo! ğŸ”¥",
Â  "Â¡Ole tÃº huevos! ğŸ’ª",
Â  "Â¡Exacto, estÃ¡s on fire! ğŸš€",
Â  "Â¡QuÃ© mÃ¡quina eres! ğŸ˜",
Â  "Â¡Correcto, asÃ­ se hace! ğŸ‘",
Â  "Â¡Te lo sabes de memoria ya! ğŸ’¥"
];

// --- VARIABLES ---
let i = 0;
let puntuacion = 0;
let preguntasParaEsteTest = [];

// --- FUNCIONES ---

/**
 * Baraja un array aleatoriamente (algoritmo Fisher-Yates).
 * @param {Array} array El array a barajar.
 */
function barajarPreguntas(array) {
  let currentIndex = array.length,  randomIndex;

  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
  return array;
}

/**
 * Muestra un mensaje en el chat.
 * @param {string} texto El contenido del mensaje.
 * @param {string} tipo 'bot' o 'user'.
 */
function mostrarMensaje(texto, tipo) {
Â  const chat = document.getElementById("chat");
Â  const msg = document.createElement("div");
Â  msg.classList.add("message", tipo);
  // Convierte los saltos de lÃ­nea (\n) en etiquetas <br>
Â  msg.innerHTML = texto.replace(/\n/g, "<br>");
Â  chat.appendChild(msg);
Â  chat.scrollTop = chat.scrollHeight;
}

/**
 * Muestra la pregunta actual y sus opciones en un solo mensaje.
 */
function mostrarPregunta() {
  // Usa el array de 20 preguntas
Â  if (!preguntasParaEsteTest[i]) return;

Â  const p = preguntasParaEsteTest[i];
  // Une la pregunta y las opciones en un solo texto
Â  const textoCompleto = `${p.texto}\n\n${p.opciones.join("\n")}`;
Â  mostrarMensaje(textoCompleto, "bot");
}

/**
 * Procesa la respuesta del usuario.
 * @param {string} opcionElegida "a", "b", "c" o "d".
 */
function responder(opcionElegida) {
  // Usa el array de 20 preguntas
Â  if (!preguntasParaEsteTest[i]) return;

Â  const p = preguntasParaEsteTest[i];
  // Muestra solo la letra, como pediste
Â  mostrarMensaje(`${opcionElegida.toUpperCase()}`, "user");

Â  if (opcionElegida === p.correcta) {
Â  Â  puntuacion++;
Â  Â  mostrarMensaje(frases_animo[Math.floor(Math.random() * frases_animo.length)], "bot");
Â  } else {
Â  Â  mostrarMensaje(`âŒ Incorrecto. La respuesta correcta era ${p.correcta.toUpperCase()}.`, "bot");
Â  }

Â  i++;
  // Comprueba si quedan preguntas en el array de 20
Â  if (i < preguntasParaEsteTest.length) {
Â  Â  setTimeout(mostrarPregunta, 800);
Â  } else {
Â  Â  setTimeout(() => {
      // Muestra la puntuaciÃ³n final sobre 20 (o el total que haya)
Â  Â  Â  mostrarMensaje(`ğŸ Has acertado ${puntuacion} de ${preguntasParaEsteTest.length} preguntas. ğŸ’¡`, "bot");
Â  Â  Â  desactivarBotones();
Â  Â  }, 800);
Â  }
}

/**
 * Desactiva los botones de opciÃ³n al final del test.
 */
function desactivarBotones() {
Â  document.querySelectorAll(".btn-opcion").forEach(btn => btn.disabled = true);
}

// --- ARRANQUE ---
document.addEventListener("DOMContentLoaded", () => {
Â  i = 0;
Â  puntuacion = 0;
  
  // 1. Barajamos TODO el array de preguntas
  barajarPreguntas(preguntas); 
  
  // 2. Nos quedamos solo con las 20 primeras (o menos, si el array es mÃ¡s corto)
  preguntasParaEsteTest = preguntas.slice(0, 20); 

Â  mostrarMensaje(`ğŸ§  Bienvenido al test. Se han elegido ${preguntasParaEsteTest.length} preguntas al azar. ğŸ’¬`, "bot");
Â  setTimeout(mostrarPregunta, 500);

Â  document.getElementById("btnA").onclick = () => responder("a");
Â  document.getElementById("btnB").onclick = () => responder("b");
Â  document.getElementById("btnC").onclick = () => responder("c");
Â  document.getElementById("btnD").onclick = () => responder("d");
});


